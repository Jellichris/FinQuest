<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinQuest - Gamified Finance Demo</title>
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <!-- å¼•å…¥ Babel ç”¨äºè§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <style>
        body { background-color: #111827; color: white; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- æ¨¡æ‹Ÿæ•°æ® ---
        const INITIAL_QUESTS = [
            { id: 1, title: "æ¯æ—¥å›é¡¾ï¼šæ˜¨æ—¥è´¦å•", reward: 50, type: "Daily", completed: false, description: "æ£€æŸ¥æ˜¨å¤©æ˜¯å¦æœ‰å†²åŠ¨æ¶ˆè´¹" },
            { id: 2, title: "è®¾ç½®å‘¨æœ«å¨±ä¹é¢„ç®—", reward: 100, type: "Weekly", completed: false, description: "å°†å‘¨æœ«æ”¯å‡ºæ§åˆ¶åœ¨ $50 ä»¥å†…" },
            { id: 3, title: "é˜…è¯»åè¯ˆçŸ¥è¯†ï¼šã€Šé˜²èŒƒåˆ·å•ã€‹", reward: 150, type: "Learning", completed: false, description: "å­¦ä¹ è¯†åˆ«ç½‘ç»œå…¼èŒè¯ˆéª—" },
        ];

        const INITIAL_CHAT = [
            { id: 1, role: 'ai', text: "ä½ å¥½ Alexï¼æˆ‘æ˜¯ä½ çš„ Fin-Coachã€‚ğŸ‘‹\nåˆšæ‰æˆ‘æ³¨æ„åˆ°åœ¨ 'Steam Games' æœ‰ä¸€ç¬” $20 çš„æ”¯å‡ºï¼Œè¿™æ˜¯è®¡åˆ’å†…çš„å¨±ä¹æ¶ˆè´¹å—ï¼ŸğŸ›¡ï¸" },
        ];

        function FinQuestApp() {
            const [activeTab, setActiveTab] = useState('home');
            const [user, setUser] = useState({
                name: "Alex",
                level: 5,
                xp: 750,
                xpToNext: 1000,
                balance: 1250.00,
                lockedSavings: 300.00,
                streak: 12,
            });
            const [quests, setQuests] = useState(INITIAL_QUESTS);
            const [chatHistory, setChatHistory] = useState(INITIAL_CHAT);
            const [inputText, setInputText] = useState("");
            const [showLevelUp, setShowLevelUp] = useState(false);
            const [lockAmount, setLockAmount] = useState(50);
            const chatEndRef = useRef(null);

            // --- é€»è¾‘å‡½æ•° ---
            const addXp = (amount) => {
                let newXp = user.xp + amount;
                let newLevel = user.level;
                let newXpToNext = user.xpToNext;

                if (newXp >= user.xpToNext) {
                    newXp = newXp - user.xpToNext;
                    newLevel += 1;
                    newXpToNext = Math.floor(newXpToNext * 1.2);
                    setShowLevelUp(true);
                    setTimeout(() => setShowLevelUp(false), 3000);
                }

                setUser(prev => ({ ...prev, xp: newXp, level: newLevel, xpToNext: newXpToNext }));
            };

            const handleCompleteQuest = (id, reward) => {
                const updatedQuests = quests.map(q => q.id === id ? { ...q, completed: true } : q);
                setQuests(updatedQuests);
                addXp(reward);
            };

            const handleLockFunds = () => {
                if (user.balance >= lockAmount) {
                    setUser(prev => ({
                        ...prev,
                        balance: prev.balance - lockAmount,
                        lockedSavings: prev.lockedSavings + lockAmount
                    }));
                    addXp(Math.floor(lockAmount * 1.5));
                    setActiveTab('home');
                }
            };

            const handleSendMessage = () => {
                if (!inputText.trim()) return;
                const newMsg = { id: Date.now(), role: 'user', text: inputText };
                setChatHistory(prev => [...prev, newMsg]);
                const userText = inputText.toLowerCase();
                setInputText("");

                setTimeout(() => {
                    let replyText = "è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç†è´¢é—®é¢˜ï¼å»ºè®®ä½ ä»å°é¢å®šæŠ•å¼€å§‹ã€‚ğŸ“Š";
                    if (userText.includes("è¯ˆéª—") || userText.includes("scam") || userText.includes("åˆ·å•")) {
                        replyText = "âš ï¸ è­¦æƒ•é«˜é£é™©ï¼ä»»ä½•è¦æ±‚â€˜å…ˆå«ä»˜â€™æˆ–â€˜åˆ·å•è¿”åˆ©â€™çš„è¡Œä¸ºéƒ½æœ‰æé«˜è¯ˆéª—é£é™©ã€‚å»ºè®®ç«‹å³åœæ­¢æ“ä½œå¹¶ä½¿ç”¨ App å†…çš„â€˜ä¸€é”®ä¸¾æŠ¥â€™åŠŸèƒ½ã€‚";
                    } else if (userText.includes("æŠ•èµ„") || userText.includes("invest")) {
                        replyText = "ä½œä¸ºæ–°æ‰‹ï¼Œä¸è¦æŠŠæ‰€æœ‰é¸¡è›‹æ”¾åœ¨ä¸€ä¸ªç¯®å­é‡Œã€‚ä½ å¯ä»¥è¯•è¯•æˆ‘ä»¬çš„ '$1 å¾®å‹ ETF ç»„åˆ'ã€‚ğŸ“ˆ";
                    }
                    setChatHistory(prev => [...prev, { id: Date.now() + 1, role: 'ai', text: replyText }]);
                }, 1000);
            };

            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [chatHistory, activeTab]);

            // --- æ¸²æŸ“ ---
            return (
                <div className="min-h-screen bg-gray-900 text-white font-sans selection:bg-purple-500 overflow-hidden relative max-w-md mx-auto border-x border-gray-800 shadow-2xl">
                    
                    {/* å‡çº§åŠ¨ç”» */}
                    {showLevelUp && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm animate-fade-in">
                            <div className="text-center transform scale-110 animate-bounce">
                                <div className="text-6xl mb-4">ğŸ‰</div>
                                <h2 className="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500">LEVEL UP!</h2>
                                <p className="text-2xl mt-2 text-white font-bold">Lvl {user.level}</p>
                            </div>
                        </div>
                    )}

                    {/* é¡¶éƒ¨æ  */}
                    <div className="sticky top-0 z-30 bg-gray-900/90 backdrop-blur-md border-b border-gray-800 px-4 py-3 flex items-center justify-between">
                        <div className="flex items-center space-x-3">
                            <div className="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center border-2 border-indigo-500 text-2xl">
                                ğŸ§‘â€ğŸ“
                            </div>
                            <div>
                                <div className="text-sm font-bold flex items-center">
                                    {user.name} <span className="ml-2 text-xs bg-yellow-500/20 text-yellow-400 px-1.5 py-0.5 rounded border border-yellow-500/30">Lvl {user.level}</span>
                                </div>
                                <div className="w-24 h-1.5 bg-gray-700 rounded-full mt-1 relative overflow-hidden">
                                    <div className="absolute top-0 left-0 h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-500" style={{ width: `${(user.xp / user.xpToNext) * 100}%` }}></div>
                                </div>
                            </div>
                        </div>
                        <div className="flex items-center space-x-4">
                             <span className="text-xs text-orange-400 font-bold">ğŸ”¥ {user.streak} Days</span>
                        </div>
                    </div>

                    {/* å†…å®¹åŒº */}
                    <div className="pb-24 pt-4 px-4 h-[calc(100vh-80px)] overflow-y-auto no-scrollbar">
                        
                        {activeTab === 'home' && (
                            <div className="space-y-6 animate-fade-in">
                                <div className="grid grid-cols-2 gap-3">
                                    <div className="bg-gray-800 p-4 rounded-2xl border border-gray-700">
                                        <div className="text-gray-400 text-xs mb-1">ğŸ’° å¯ç”¨ä½™é¢</div>
                                        <div className="text-2xl font-bold">${user.balance.toFixed(2)}</div>
                                    </div>
                                    <div className="bg-gray-800 p-4 rounded-2xl border border-blue-500/30 relative overflow-hidden">
                                        <div className="text-blue-400 text-xs mb-1">ğŸ”’ æ™ºèƒ½é”ä»“</div>
                                        <div className="text-2xl font-bold text-blue-50">${user.lockedSavings.toFixed(2)}</div>
                                        <div className="text-[10px] text-blue-400 mt-1">+2.5% APY</div>
                                    </div>
                                </div>
                                <div>
                                    <h3 className="text-gray-500 text-xs font-bold uppercase mb-3">å¿«é€Ÿè¡ŒåŠ¨</h3>
                                    <div className="grid grid-cols-3 gap-3">
                                        <button onClick={() => setActiveTab('smartlock')} className="bg-gray-800 p-3 rounded-xl flex flex-col items-center gap-2 border border-gray-700 hover:bg-gray-700">
                                            <span className="text-xl">ğŸ·</span><span className="text-xs">å­˜é’±</span>
                                        </button>
                                        <button onClick={() => setActiveTab('quests')} className="bg-gray-800 p-3 rounded-xl flex flex-col items-center gap-2 border border-gray-700 hover:bg-gray-700">
                                            <span className="text-xl">ğŸ“œ</span><span className="text-xs">åšä»»åŠ¡</span>
                                        </button>
                                        <button onClick={() => setActiveTab('ai')} className="bg-gray-800 p-3 rounded-xl flex flex-col items-center gap-2 border border-gray-700 hover:bg-gray-700">
                                            <span className="text-xl">ğŸ¤–</span><span className="text-xs">AIæ•™ç»ƒ</span>
                                        </button>
                                    </div>
                                </div>
                                <div className="bg-gradient-to-r from-gray-800 to-gray-900 border border-purple-500/30 rounded-2xl p-5">
                                    <h3 className="text-purple-400 text-xs font-bold mb-1">ğŸ† é™æ—¶æ´»åŠ¨</h3>
                                    <h2 className="text-lg font-bold mb-2">å…¨æ ¡â€œå­˜é’±é©¬æ‹‰æ¾â€</h2>
                                    <p className="text-xs text-gray-400 mb-4">åšæŒ30å¤©ä¸å–å¥¶èŒ¶ï¼Œèµ¢å–é™å®šçš®è‚¤ï¼</p>
                                    <button className="bg-purple-600 text-white text-xs font-bold px-4 py-2 rounded-lg">ç«‹å³æŠ¥å</button>
                                </div>
                            </div>
                        )}

                        {activeTab === 'quests' && (
                            <div className="space-y-4 animate-fade-in">
                                <h2 className="text-2xl font-bold">ä»Šæ—¥ä»»åŠ¡ ğŸ“œ</h2>
                                {quests.map(quest => (
                                    <div key={quest.id} className={`p-4 rounded-xl border ${quest.completed ? 'bg-gray-900 border-gray-800 opacity-60' : 'bg-gray-800 border-gray-700'}`}>
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <h3 className={`font-bold ${quest.completed ? 'line-through text-gray-500' : ''}`}>{quest.title}</h3>
                                                <p className="text-xs text-gray-400 mt-1">{quest.description}</p>
                                            </div>
                                            <span className="text-xs font-bold text-purple-400">+{quest.reward} XP</span>
                                        </div>
                                        {!quest.completed ? (
                                            <button onClick={() => handleCompleteQuest(quest.id, quest.reward)} className="w-full mt-2 bg-gray-700 hover:bg-purple-600 text-xs font-bold py-2 rounded-lg">âœ… é¢†å–å¥–åŠ±</button>
                                        ) : (
                                            <div className="mt-2 text-center text-xs text-green-500 font-bold">å·²å®Œæˆ</div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'smartlock' && (
                            <div className="animate-fade-in text-center pt-10">
                                <div className="text-6xl mb-4">ğŸ”</div>
                                <h2 className="text-2xl font-bold mb-8">å¼ºåˆ¶å‚¨è“„åˆçº¦</h2>
                                <div className="bg-gray-800 p-6 rounded-2xl border border-gray-700 shadow-xl">
                                    <div className="text-4xl font-bold mb-6 text-blue-400">${lockAmount}</div>
                                    <input type="range" min="10" max={user.balance} step="10" value={lockAmount} onChange={(e) => setLockAmount(Number(e.target.value))} className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer mb-8" />
                                    <div className="flex justify-between text-sm mb-6 border-t border-b border-gray-700 py-4">
                                        <span>é¢„è®¡æ”¶ç›Š: <span className="text-green-400">2.5%</span></span>
                                        <span>å¥–åŠ±: <span className="text-purple-400">+{Math.floor(lockAmount * 1.5)} XP</span></span>
                                    </div>
                                    <button onClick={handleLockFunds} className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl">âœï¸ ç­¾ç½²åˆçº¦å¹¶é”å®š</button>
                                </div>
                            </div>
                        )}

                        {activeTab === 'ai' && (
                            <div className="flex flex-col h-full animate-fade-in pb-4">
                                <div className="flex-1 overflow-y-auto space-y-4 mb-4 pr-2">
                                    {chatHistory.map((msg) => (
                                        <div key={msg.id} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                            <div className={`max-w-[85%] p-3 rounded-2xl text-sm ${msg.role === 'user' ? 'bg-purple-600' : 'bg-gray-800 border border-gray-700'}`}>
                                                {msg.text}
                                            </div>
                                        </div>
                                    ))}
                                    <div ref={chatEndRef} />
                                </div>
                                <div className="relative flex gap-2">
                                    <input type="text" value={inputText} onChange={(e) => setInputText(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()} placeholder="è¯¢é—®å»ºè®®..." className="w-full bg-gray-800 border border-gray-700 rounded-xl py-3 pl-4 focus:outline-none focus:border-purple-500" />
                                    <button onClick={handleSendMessage} className="bg-purple-600 px-4 rounded-xl">â¤</button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* åº•éƒ¨å¯¼èˆª */}
                    <div className="fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-800 pb-safe pt-2 px-6 h-20 flex justify-between max-w-md mx-auto z-40">
                        <button onClick={() => setActiveTab('home')} className={`flex flex-col items-center ${activeTab === 'home' ? 'text-purple-400' : 'text-gray-500'}`}><span className="text-2xl">ğŸ </span><span className="text-[10px]">ä¸»é¡µ</span></button>
                        <button onClick={() => setActiveTab('quests')} className={`flex flex-col items-center ${activeTab === 'quests' ? 'text-purple-400' : 'text-gray-500'}`}><span className="text-2xl">ğŸ“œ</span><span className="text-[10px]">ä»»åŠ¡</span></button>
                        <button onClick={() => setActiveTab('smartlock')} className={`flex flex-col items-center ${activeTab === 'smartlock' ? 'text-blue-400' : 'text-gray-500'}`}><span className="text-2xl">ğŸ”</span><span className="text-[10px]">å­˜é’±</span></button>
                        <button onClick={() => setActiveTab('ai')} className={`flex flex-col items-center ${activeTab === 'ai' ? 'text-green-400' : 'text-gray-500'}`}><span className="text-2xl">ğŸ¤–</span><span className="text-[10px]">AI</span></button>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FinQuestApp />);
    </script>
</body>
</html>